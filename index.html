<!DOCTYPE html>
<html lang="es" class="scroll-smooth">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CUAFIJAS | Dashboard Gerencial Integral</title>
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Montserrat:wght@500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <style>
        /* Custom Styles & Theme */
        :root {
            --primary: #0f172a;   /* Slate 900 */
            --secondary: #0ea5e9; /* Sky 500 */
            --accent: #f59e0b;    /* Amber 500 */
            --bg-light: #f1f5f9;  /* Slate 100 */
        }
        
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--bg-light);
            color: #334155;
        }
        
        h1, h2, h3, h4, h5, h6 {
            font-family: 'Montserrat', sans-serif;
        }

        /* Sidebar Styles */
        .sidebar-link {
            display: flex;
            align-items: center;
            padding: 0.75rem 1.5rem;
            color: #94a3b8;
            transition: all 0.3s ease;
            border-left: 4px solid transparent;
            font-weight: 500;
        }
        
        .sidebar-link:hover, .sidebar-link.active {
            color: white;
            background-color: rgba(255, 255, 255, 0.05);
            border-left-color: var(--secondary);
        }

        .sidebar-link i {
            width: 24px;
            margin-right: 12px;
            text-align: center;
        }

        /* Tab Buttons for Table */
        .tab-btn {
            @apply px-4 py-2 text-sm font-medium rounded-t-lg border-b-2 border-transparent hover:text-sky-600 hover:border-sky-300 transition-colors;
        }
        .tab-btn.active {
            @apply text-sky-600 border-sky-600 bg-white;
        }

        /* Card Hover Effects */
        .card-hover {
            transition: transform 0.2s, box-shadow 0.2s;
        }
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }

        .chart-container {
            position: relative;
            height: 300px;
            width: 100%;
        }
        
        /* Timeline Steps */
        .step-item {
            @apply relative flex flex-col justify-center items-center w-36;
        }
        .step-item:not(:first-child):before {
            @apply content-[''] bg-slate-200 absolute w-full h-[3px] right-1/2 top-1/3 -translate-y-1/2 -z-10;
        }
        .step-circle {
            @apply w-10 h-10 flex items-center justify-center rounded-full font-bold text-white bg-slate-300 z-10 ring-4 ring-white transition-colors duration-300;
        }
        .step-active .step-circle {
            @apply bg-sky-500;
        }
        .step-active:not(:first-child):before {
            @apply bg-sky-500;
        }

        /* Sensitivity Table Cells */
        .sens-cell {
            @apply px-2 py-3 text-center text-xs font-bold border border-slate-100 transition-colors hover:opacity-80 cursor-help;
        }
        .sens-bad { @apply bg-red-100 text-red-700; }
        .sens-warn { @apply bg-amber-100 text-amber-700; }
        .sens-good { @apply bg-emerald-100 text-emerald-700; }
        .sens-excel { @apply bg-indigo-100 text-indigo-700; }

        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 6px;
            height: 6px;
        }
        ::-webkit-scrollbar-track {
            background: #1e293b; 
        }
        ::-webkit-scrollbar-thumb {
            background: #475569; 
            border-radius: 3px;
        }
        ::-webkit-scrollbar-thumb:hover {
            background: #64748b; 
        }
    </style>
</head>
<body class="bg-slate-100">

    <!-- Mobile Header -->
    <header class="md:hidden bg-slate-900 text-white p-4 fixed top-0 w-full z-50 flex justify-between items-center shadow-md">
        <div class="flex items-center space-x-2">
            <i class="fa-solid fa-mountain text-sky-500 text-xl"></i>
            <span class="font-Montserrat font-bold text-lg tracking-wider">CUAFIJAS</span>
        </div>
        <button id="menuBtn" class="text-gray-300 hover:text-white focus:outline-none">
            <i class="fa-solid fa-bars text-2xl"></i>
        </button>
    </header>

    <!-- Overlay for Mobile -->
    <div id="sidebarOverlay" class="fixed inset-0 bg-black bg-opacity-50 z-40 hidden md:hidden backdrop-blur-sm transition-opacity"></div>

    <div class="flex min-h-screen pt-16 md:pt-0">
        
        <!-- Sidebar Navigation -->
        <aside id="sidebar" class="fixed inset-y-0 left-0 z-50 w-64 bg-slate-900 text-white transform -translate-x-full md:translate-x-0 transition-transform duration-300 ease-in-out shadow-2xl flex flex-col">
            <!-- Logo Area -->
            <div class="h-16 flex items-center px-6 border-b border-slate-800 bg-slate-950">
                <i class="fa-solid fa-mountain text-sky-500 text-2xl mr-3"></i>
                <div>
                    <h1 class="font-Montserrat font-bold text-xl tracking-wider leading-none">CUAFIJAS</h1>
                    <span class="text-[10px] text-slate-500 uppercase tracking-widest">Proyecto Minero</span>
                </div>
            </div>

            <!-- Navigation Links -->
            <nav class="flex-1 py-6 space-y-1 overflow-y-auto">
                <p class="px-6 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2">Gestión</p>
                
                <a href="#dashboard" class="sidebar-link active" onclick="closeSidebar()">
                    <i class="fa-solid fa-gauge-high"></i>
                    Dashboard
                </a>
                <a href="#estrategia" class="sidebar-link" onclick="closeSidebar()">
                    <i class="fa-solid fa-chess-knight"></i>
                    Estrategia
                </a>
                <a href="#cronograma" class="sidebar-link" onclick="closeSidebar()">
                    <i class="fa-solid fa-timeline"></i>
                    Cronograma
                </a>
                
                <p class="px-6 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 mt-6">Costos</p>
                <a href="#costos" class="sidebar-link" onclick="closeSidebar()">
                    <i class="fa-solid fa-calculator"></i>
                    Análisis APU
                </a>
                <a href="#tabla-detalle" class="sidebar-link" onclick="closeSidebar()">
                    <i class="fa-solid fa-table-list"></i>
                    Detalle Costos
                </a>
                <a href="#flujo-caja" class="sidebar-link" onclick="closeSidebar()">
                    <i class="fa-solid fa-money-bill-trend-up"></i>
                    Flujo de Caja
                </a>

                <p class="px-6 text-xs font-bold text-slate-500 uppercase tracking-wider mb-2 mt-6">Análisis</p>
                <a href="#rentabilidad" class="sidebar-link" onclick="closeSidebar()">
                    <i class="fa-solid fa-hand-holding-dollar"></i>
                    Rentabilidad
                </a>
                <a href="#sensibilidad" class="sidebar-link" onclick="closeSidebar()">
                    <i class="fa-solid fa-table-cells"></i>
                    Sensibilidad
                </a>
                <a href="#gerencia" class="sidebar-link" onclick="closeSidebar()">
                    <i class="fa-solid fa-users-viewfinder"></i>
                    Gerencia
                </a>
            </nav>

            <!-- Actions -->
            <div class="p-4 border-t border-slate-800 bg-slate-950">
                <button onclick="window.print()" class="w-full bg-sky-600 hover:bg-sky-700 text-white text-sm font-bold py-2 px-4 rounded flex items-center justify-center transition-colors">
                    <i class="fa-solid fa-print mr-2"></i> Imprimir Reporte
                </button>
            </div>
        </aside>

        <!-- Main Content Wrapper -->
        <div class="flex-1 md:ml-64 flex flex-col min-h-screen transition-all duration-300">
            
            <!-- Main Area -->
            <main class="flex-grow p-4 md:p-8 space-y-12 max-w-7xl mx-auto w-full">

                <!-- DASHBOARD SUMMARY (KPIs) -->
                <section id="dashboard" class="scroll-mt-24 animate-fade-in">
                    <div class="flex flex-col md:flex-row justify-between items-start md:items-end mb-8">
                        <div>
                            <h2 class="text-3xl font-bold text-slate-800">Plan Estratégico 2025-2027</h2>
                            <p class="text-slate-500 mt-1">Gestión de activos propios y optimización de flujo de caja.</p>
                        </div>
                        <span class="px-4 py-1 bg-emerald-100 text-emerald-700 text-xs font-bold rounded-full border border-emerald-200 mt-4 md:mt-0">
                            Estado: En Aprobación
                        </span>
                    </div>

                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6">
                        <!-- KPI 1 -->
                        <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-sky-500 card-hover">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">CAPEX Inicial</p>
                                    <h3 class="text-2xl font-bold text-slate-800 mt-1">$1.08 M</h3>
                                </div>
                                <div class="p-2 bg-sky-100 rounded-lg text-sky-600"><i class="fa-solid fa-sack-dollar"></i></div>
                            </div>
                            <p class="text-sm text-slate-500 mt-4"><span class="text-emerald-500 font-bold">-45%</span> en tarifa mensual</p>
                        </div>
                        <!-- KPI 2 -->
                        <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-emerald-500 card-hover">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Costo All-In</p>
                                    <h3 class="text-2xl font-bold text-slate-800 mt-1">$63.90</h3>
                                </div>
                                <div class="p-2 bg-emerald-100 rounded-lg text-emerald-600"><i class="fa-solid fa-tag"></i></div>
                            </div>
                            <p class="text-sm text-slate-500 mt-4">Break-even Operativo</p>
                        </div>
                        <!-- KPI 3 -->
                        <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-amber-500 card-hover">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Margen Neto</p>
                                    <h3 class="text-2xl font-bold text-slate-800 mt-1">11.8%</h3>
                                </div>
                                <div class="p-2 bg-amber-100 rounded-lg text-amber-600"><i class="fa-solid fa-chart-pie"></i></div>
                            </div>
                            <p class="text-sm text-slate-500 mt-4">Escenario Base</p>
                        </div>
                        <!-- KPI 4 -->
                        <div class="bg-white rounded-xl shadow-sm p-6 border-l-4 border-indigo-500 card-hover">
                            <div class="flex justify-between items-start">
                                <div>
                                    <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Payback</p>
                                    <h3 class="text-2xl font-bold text-slate-800 mt-1">14 Meses</h3>
                                </div>
                                <div class="p-2 bg-indigo-100 rounded-lg text-indigo-600"><i class="fa-solid fa-clock-rotate-left"></i></div>
                            </div>
                            <p class="text-sm text-slate-500 mt-4">Retorno de Inversión</p>
                        </div>
                    </div>
                </section>

                <!-- NEW: TIMELINE SECTION -->
                <section id="cronograma" class="scroll-mt-24">
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-8">
                        <h2 class="text-xl font-bold text-slate-800 mb-8 flex items-center">
                            <i class="fa-solid fa-timeline text-sky-500 mr-3"></i> Cronograma de Hitos Principales
                        </h2>
                        <div class="flex justify-between items-center w-full overflow-x-auto pb-4">
                            <div class="step-item step-active">
                                <div class="step-circle">1</div>
                                <p class="text-xs font-bold mt-2 text-slate-800">Mes 1</p>
                                <p class="text-[10px] text-slate-500 text-center leading-tight">Compra de Equipos<br>(Capex)</p>
                            </div>
                            <div class="step-item step-active">
                                <div class="step-circle">2</div>
                                <p class="text-xs font-bold mt-2 text-slate-800">Mes 2-3</p>
                                <p class="text-[10px] text-slate-500 text-center leading-tight">Movilización &<br>Accesos</p>
                            </div>
                            <div class="step-item">
                                <div class="step-circle">3</div>
                                <p class="text-xs font-bold mt-2 text-slate-800">Mes 4</p>
                                <p class="text-[10px] text-slate-500 text-center leading-tight">Inicio Desarrollo<br>Galerías</p>
                            </div>
                            <div class="step-item">
                                <div class="step-circle">4</div>
                                <p class="text-xs font-bold mt-2 text-slate-800">Mes 6</p>
                                <p class="text-[10px] text-slate-500 text-center leading-tight">Intersección<br>Veta</p>
                            </div>
                            <div class="step-item">
                                <div class="step-circle">5</div>
                                <p class="text-xs font-bold mt-2 text-slate-800">Mes 7+</p>
                                <p class="text-[10px] text-slate-500 text-center leading-tight">Producción<br>Sostenida</p>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- STRATEGY & BUDGET -->
                <section id="estrategia" class="scroll-mt-24">
                    <div class="flex flex-col lg:flex-row gap-8">
                        <div class="lg:w-1/3 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                            <h3 class="font-bold text-slate-700 mb-4 text-sm uppercase">Modelo de Negocio</h3>
                            <p class="text-sm text-slate-600 mb-4">La mina asume activos y materiales volátiles. El contratista se enfoca en la operación.</p>
                            <div class="space-y-2 text-sm">
                                <div class="flex justify-between p-2 bg-sky-50 rounded border-l-4 border-sky-500">
                                    <span>Maquinaria</span> <span class="font-bold text-sky-700">MINA</span>
                                </div>
                                <div class="flex justify-between p-2 bg-sky-50 rounded border-l-4 border-sky-500">
                                    <span>Insumos</span> <span class="font-bold text-sky-700">MINA</span>
                                </div>
                                <div class="flex justify-between p-2 bg-indigo-50 rounded border-l-4 border-indigo-500">
                                    <span>Mano de Obra</span> <span class="font-bold text-indigo-700">CONTRATA</span>
                                </div>
                            </div>
                        </div>
                        <div class="lg:w-2/3 bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                            <h3 class="font-bold text-slate-700 mb-4 text-sm uppercase text-center">Distribución del Presupuesto</h3>
                            <div class="chart-container" style="height: 250px;">
                                <canvas id="budgetChart"></canvas>
                            </div>
                        </div>
                    </div>
                </section>

                <!-- COST ANALYSIS -->
                <section id="costos" class="scroll-mt-24 grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                        <h3 class="font-bold text-slate-700 mb-4 text-sm uppercase">Costos Horarios Base</h3>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="hourlyCostChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                        <h3 class="font-bold text-slate-700 mb-4 text-sm uppercase">Desglose APU ($/m)</h3>
                        <div class="chart-container" style="height: 250px;">
                            <canvas id="apuChart"></canvas>
                        </div>
                    </div>
                </section>

                <!-- COST TABLE -->
                <section id="tabla-detalle" class="scroll-mt-24">
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 overflow-hidden">
                        <div class="p-4 bg-slate-50 border-b border-slate-200">
                            <h2 class="font-bold text-slate-800">Desglose Detallado</h2>
                        </div>
                        <!-- Tabs -->
                        <div class="flex border-b border-slate-200 px-4 pt-2 gap-2 overflow-x-auto">
                            <button class="tab-btn px-4 py-2 text-sm font-medium text-sky-600 border-b-2 border-sky-600 bg-white" onclick="filterTable('all', this)">Todos</button>
                            <button class="tab-btn px-4 py-2 text-sm font-medium text-slate-500 border-b-2 border-transparent hover:text-slate-700" onclick="filterTable('equipos', this)">Equipos</button>
                            <button class="tab-btn px-4 py-2 text-sm font-medium text-slate-500 border-b-2 border-transparent hover:text-slate-700" onclick="filterTable('apu', this)">APU</button>
                        </div>
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm text-left text-slate-600">
                                <thead class="text-xs text-slate-700 uppercase bg-slate-100 border-b border-slate-200">
                                    <tr>
                                        <th class="px-6 py-3">Ítem</th>
                                        <th class="px-6 py-3 text-right">Unitario</th>
                                        <th class="px-6 py-3 text-center">Responsable</th>
                                    </tr>
                                </thead>
                                <tbody id="costTableBody" class="divide-y divide-slate-200">
                                    <tr data-category="equipos" class="bg-white"><td class="px-6 py-3">Dumper 5m³</td><td class="px-6 py-3 text-right text-sky-600">$61.07 /h</td><td class="px-6 py-3 text-center"><span class="bg-sky-100 text-sky-700 text-xs px-2 py-1 rounded">MINA</span></td></tr>
                                    <tr data-category="equipos" class="bg-slate-50"><td class="px-6 py-3">Jumbo 1 Brazo</td><td class="px-6 py-3 text-right text-sky-600">$78.50 /h</td><td class="px-6 py-3 text-center"><span class="bg-sky-100 text-sky-700 text-xs px-2 py-1 rounded">MINA</span></td></tr>
                                    <tr data-category="apu" class="bg-white"><td class="px-6 py-3">Costo Interno APU</td><td class="px-6 py-3 text-right font-bold">$528.50 /m</td><td class="px-6 py-3 text-center"><span class="bg-sky-100 text-sky-700 text-xs px-2 py-1 rounded">MINA</span></td></tr>
                                    <tr data-category="apu" class="bg-slate-50"><td class="px-6 py-3">Tarifa Contratista</td><td class="px-6 py-3 text-right font-bold text-indigo-600">$98.90 /m</td><td class="px-6 py-3 text-center"><span class="bg-indigo-100 text-indigo-700 text-xs px-2 py-1 rounded">CONTRATA</span></td></tr>
                                </tbody>
                            </table>
                        </div>
                    </div>
                </section>

                <!-- NEW: CASH FLOW SECTION -->
                <section id="flujo-caja" class="scroll-mt-24">
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                        <div class="flex justify-between items-center mb-6">
                            <h2 class="text-xl font-bold text-slate-800 flex items-center">
                                <i class="fa-solid fa-money-bill-trend-up text-emerald-500 mr-3"></i> Flujo de Caja Proyectado
                            </h2>
                            <span class="text-xs bg-slate-100 text-slate-500 px-2 py-1 rounded">Miles de USD</span>
                        </div>
                        <div class="chart-container" style="height: 350px;">
                            <canvas id="cashFlowChart"></canvas>
                        </div>
                        <p class="text-center text-sm text-slate-500 mt-4">Nótese el pico de CAPEX en Mes 1 (Compra Equipos) y el inicio de ingresos en Mes 6.</p>
                    </div>
                </section>

                <!-- PROFITABILITY & SENSITIVITY -->
                <section id="rentabilidad" class="scroll-mt-24 grid grid-cols-1 lg:grid-cols-2 gap-8">
                    <!-- Waterfall -->
                    <div class="bg-white rounded-xl shadow-sm border border-slate-200 p-6">
                        <h2 class="font-bold text-slate-800 mb-4">Estructura de Margen ($/TM)</h2>
                        <div class="chart-container" style="height: 300px;">
                            <canvas id="profitabilityChart"></canvas>
                        </div>
                    </div>

                    <!-- NEW: SENSITIVITY HEATMAP -->
                    <div id="sensibilidad" class="bg-white rounded-xl shadow-sm border border-slate-200 p-6 scroll-mt-24">
                        <h2 class="font-bold text-slate-800 mb-4 flex items-center">
                            <i class="fa-solid fa-table-cells text-amber-500 mr-2"></i> Matriz de Sensibilidad (Margen %)
                        </h2>
                        <p class="text-xs text-slate-500 mb-4">Impacto en margen neto según variaciones en Precio del Metal (Eje Y) vs. Costo Operativo (Eje X).</p>
                        
                        <div class="overflow-x-auto">
                            <table class="w-full text-sm border-collapse">
                                <thead>
                                    <tr>
                                        <th class="p-2 bg-slate-100 border border-slate-200 text-xs text-slate-500">Precio \ Costo</th>
                                        <th class="p-2 bg-slate-50 border border-slate-200 text-xs">-10% ($57)</th>
                                        <th class="p-2 bg-slate-50 border border-slate-200 text-xs font-bold border-x-2 border-x-sky-200">Base ($64)</th>
                                        <th class="p-2 bg-slate-50 border border-slate-200 text-xs">+10% ($70)</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <tr>
                                        <td class="p-2 bg-slate-50 border border-slate-200 font-bold text-xs text-right">+10% ($80)</td>
                                        <td class="sens-cell sens-excel">28%</td>
                                        <td class="sens-cell sens-good border-x-2 border-x-sky-200">20%</td>
                                        <td class="sens-cell sens-warn">12%</td>
                                    </tr>
                                    <tr class="border-y-2 border-y-sky-200">
                                        <td class="p-2 bg-slate-50 border border-slate-200 font-bold text-xs text-right border-y-2 border-y-sky-200">Base ($72.5)</td>
                                        <td class="sens-cell sens-good border-y-2 border-y-sky-200">21%</td>
                                        <td class="sens-cell sens-warn border-2 border-sky-400 relative">
                                            11.8%
                                            <span class="absolute top-0 right-0 w-2 h-2 bg-sky-500 rounded-full -mt-1 -mr-1 animate-ping"></span>
                                        </td>
                                        <td class="sens-cell sens-bad border-y-2 border-y-sky-200">3%</td>
                                    </tr>
                                    <tr>
                                        <td class="p-2 bg-slate-50 border border-slate-200 font-bold text-xs text-right">-10% ($65)</td>
                                        <td class="sens-cell sens-warn">12%</td>
                                        <td class="sens-cell sens-bad border-x-2 border-x-sky-200">1.5%</td>
                                        <td class="sens-cell sens-bad bg-red-200 text-red-900">-7%</td>
                                    </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="mt-4 flex justify-between text-xs text-slate-500">
                            <div class="flex items-center"><div class="w-3 h-3 bg-red-100 mr-1"></div> Crítico</div>
                            <div class="flex items-center"><div class="w-3 h-3 bg-amber-100 mr-1"></div> Riesgo</div>
                            <div class="flex items-center"><div class="w-3 h-3 bg-emerald-100 mr-1"></div> Saludable</div>
                        </div>
                    </div>
                </section>

                <!-- MANAGEMENT -->
                <section id="gerencia" class="scroll-mt-24 mb-12">
                    <h2 class="text-2xl font-bold text-slate-800 mb-6 text-center">Estrategia de Mitigación</h2>
                    <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                        <div class="bg-white p-6 rounded-xl border-l-4 border-red-500 shadow-sm">
                            <h4 class="font-bold text-slate-800 mb-2">Operaciones</h4>
                            <p class="text-sm text-slate-600">"Control topográfico diario para evitar dilución y mantener la ley de cabeza."</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border-l-4 border-amber-500 shadow-sm">
                            <h4 class="font-bold text-slate-800 mb-2">Logística</h4>
                            <p class="text-sm text-slate-600">"Racionamiento de diésel y explosivos. Penalidad contractual por sobreconsumo."</p>
                        </div>
                        <div class="bg-white p-6 rounded-xl border-l-4 border-emerald-500 shadow-sm">
                            <h4 class="font-bold text-slate-800 mb-2">Admin</h4>
                            <p class="text-sm text-slate-600">"Pago a proveedores a 45 días para mitigar el impacto del CAPEX inicial en la caja."</p>
                        </div>
                    </div>
                </section>

            </main>

            <!-- Footer -->
            <footer class="bg-white border-t border-slate-200 py-8 text-center">
                <p class="text-xs text-slate-400">Informe Técnico Confidencial © 2025 MINERA CUAFIJAS</p>
            </footer>
        </div>
    </div>

    <!-- Scripts -->
    <script>
        // Sidebar & Table Logic
        const menuBtn = document.getElementById('menuBtn');
        const sidebar = document.getElementById('sidebar');
        const sidebarOverlay = document.getElementById('sidebarOverlay');
        const navLinks = document.querySelectorAll('.sidebar-link');

        function toggleSidebar() { sidebar.classList.toggle('-translate-x-full'); sidebarOverlay.classList.toggle('hidden'); }
        function closeSidebar() { sidebar.classList.add('-translate-x-full'); sidebarOverlay.classList.add('hidden'); }
        menuBtn.addEventListener('click', toggleSidebar);
        sidebarOverlay.addEventListener('click', closeSidebar);
        navLinks.forEach(link => link.addEventListener('click', () => { if(window.innerWidth < 768) closeSidebar(); }));

        function filterTable(category, btnElement) {
            const rows = document.querySelectorAll('#costTableBody tr');
            document.querySelectorAll('.tab-btn').forEach(btn => {
                btn.classList.remove('text-sky-600', 'border-sky-600', 'bg-white');
                btn.classList.add('text-slate-500', 'border-transparent');
            });
            btnElement.classList.remove('text-slate-500', 'border-transparent');
            btnElement.classList.add('text-sky-600', 'border-sky-600', 'bg-white');
            rows.forEach(row => row.style.display = (category === 'all' || row.getAttribute('data-category') === category) ? '' : 'none');
        }

        // Charts Config
        Chart.defaults.font.family = "'Inter', sans-serif";
        Chart.defaults.color = '#64748b';
        const colors = { mina: '#0ea5e9', contrata: '#6366f1', costo: '#ef4444', ingreso: '#10b981', neutral: '#94a3b8' };

        // 1. Budget Donut
        new Chart(document.getElementById('budgetChart'), {
            type: 'doughnut',
            data: { labels: ['Mina (Activos)', 'Contrata (Servicios)'], datasets: [{ data: [756778, 327372], backgroundColor: [colors.mina, colors.contrata], borderWidth: 0 }] },
            options: { responsive: true, maintainAspectRatio: false, cutout: '65%', plugins: { legend: { position: 'bottom', labels: { usePointStyle: true, padding: 20 } } } }
        });

        // 2. Hourly Bar
        new Chart(document.getElementById('hourlyCostChart'), {
            type: 'bar',
            data: { labels: ['Jumbo', 'Dumper', 'Scoop', 'Operador', 'Ayudante'], datasets: [{ label: 'USD/Hora', data: [78.50, 61.07, 55.20, 6.97, 3.67], backgroundColor: [colors.mina, colors.mina, colors.mina, colors.contrata, colors.contrata], borderRadius: 4 }] },
            options: { indexAxis: 'y', responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { x: { grid: { display: false } }, y: { grid: { display: false } } } }
        });

        // 3. APU Stacked
        new Chart(document.getElementById('apuChart'), {
            type: 'bar',
            data: {
                labels: ['Mano Obra', 'Equipos', 'Materiales', 'GG+Util'],
                datasets: [
                    { label: 'Mina', data: [0, 318, 210, 0], backgroundColor: colors.mina },
                    { label: 'Contrata', data: [34, 40, 5, 19], backgroundColor: colors.contrata }
                ]
            },
            options: { responsive: true, maintainAspectRatio: false, scales: { x: { stacked: true, grid: { display: false } }, y: { stacked: true, grid: { color: '#f1f5f9' } } }, plugins: { legend: { position: 'bottom' } } }
        });

        // 4. Profitability Waterfall
        new Chart(document.getElementById('profitabilityChart'), {
            type: 'bar',
            data: {
                labels: ['NSR', 'Minado', 'Planta', 'Gral', 'Amort', 'Margen'],
                datasets: [{
                    label: 'USD/TM',
                    data: [[0, 72.5], [44.5, 72.5], [26, 44.5], [14, 26], [8.6, 14], [0, 8.6]],
                    backgroundColor: [colors.ingreso, colors.costo, colors.costo, colors.costo, colors.neutral, '#f59e0b'],
                    borderRadius: 4
                }]
            },
            options: { responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } }, scales: { y: { beginAtZero: true, grid: { color: '#f1f5f9' } }, x: { grid: { display: false } } } }
        });

        // 5. NEW: CASH FLOW CHART
        new Chart(document.getElementById('cashFlowChart'), {
            type: 'line',
            data: {
                labels: ['M1', 'M2', 'M3', 'M4', 'M5', 'M6', 'M7', 'M8', 'M9', 'M10', 'M11', 'M12'],
                datasets: [
                    {
                        label: 'Egresos (Costos)',
                        data: [600, 300, 150, 120, 120, 120, 120, 120, 120, 120, 120, 120], // Spike at start
                        borderColor: colors.costo,
                        backgroundColor: 'rgba(239, 68, 68, 0.1)',
                        fill: true,
                        tension: 0.4
                    },
                    {
                        label: 'Ingresos (NSR)',
                        data: [0, 0, 0, 0, 50, 100, 140, 145, 145, 145, 145, 145], // Ramp up later
                        borderColor: colors.ingreso,
                        backgroundColor: 'rgba(16, 185, 129, 0.1)',
                        fill: true,
                        tension: 0.4
                    }
                ]
            },
            options: {
                responsive: true,
                maintainAspectRatio: false,
                scales: {
                    y: { beginAtZero: true, grid: { color: '#f1f5f9' } },
                    x: { grid: { display: false } }
                },
                plugins: {
                    legend: { position: 'top' }
                }
            }
        });
    </script>
</body>
</html>
